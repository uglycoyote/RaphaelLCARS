<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>TableTest</title>
<link rel="stylesheet" href="demo.css" type="text/css" media="screen">
<script src="raphael.js"></script>
<script src="jquery.js"></script>
</head>
<style>
#paperContainer{
  width : 100% ;
  height:0px;
  top:0;
  left:0;
  position:absolute;
                 }

#mainTable{
                   width : 100% ;
                   }

table{
    border: 1px dotted #FFF;
    border-collapse:separate;
    border-spacing:10px 10px;
}

td{
    border: 1px dotted #FFF;
}

body {
    font-family: Verdana, sans-serif;
    font-size: 10px;
    color: white;
}


</style>
<body>

<div id="paperContainer"></div>

<div id="mainTable">
<table class="mainTable" border=0>
<tr>
<td class="ColumnHeader">pc-build</td>
<td class="ColumnHeader">ds-build</td>
<td class="ColumnHeader">wiiu-build</td>
<tr>



<tr>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevRev " width="1%">
      59
    </td>
<td class="DevDate " width="1%">
      Wed 23:15
    </td>
<td class="DevName " width="1%">
      mike
    </td>
<td class="DevComment ">
      Follow the yellow brick road. Follow Follow,  Were off to see the wizard the wonderful wizard of oz, because because of the wonderful things she does.
    </td>
<td class="DevFiles ">
      test.xmb
    </td>
</tr>
<tr>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevRev " width="1%">
      59
    </td>
<td class="DevDate " width="1%">
      Wed 23:15
    </td>
<td class="DevName " width="1%">
      mike
    </td>
<td class="DevComment ">
      Follow the yellow brick road. Follow Follow,  Were off to see the wizard the wonderful wizard of oz, because because of the wonderful things she does.       Follow the yellow brick road. Follow Follow,  Were off to see the wizard the wonderful wizard of oz, because because of the wonderful things she does.

    </td>
<td class="DevFiles ">
      test.xmb
    </td>
</tr>
<tr>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevRev " width="1%">
      59
    </td>
<td class="DevDate " width="1%">
      Wed 23:15
    </td>
<td class="DevName " width="1%">
      mike
    </td>
<td class="DevComment ">
      Follow the yellow brick road. Follow Follow,  Were off to see the wizard the wonderful wizard of oz, because because of the wonderful things she does.
    </td>
<td class="DevFiles ">
      test.xmb
    </td>
</tr>
<tr>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevRev " width="1%">
      59
    </td>
<td class="DevDate " width="1%">
      Wed 23:15
    </td>
<td class="DevName " width="1%">
      mike
    </td>
<td class="DevComment ">
      Follow the yellow brick road. Follow Follow,  Were off to see the wizard the wonderful wizard of oz, because because of the wonderful things she does.       Follow the yellow brick road. Follow Follow,  Were off to see the wizard the wonderful wizard of oz, because because of the wonderful things she does.

      Follow the yellow brick road. Follow Follow,  Were off to see the wizard the wonderful wizard of oz, because because of the wonderful things she does.
    </td>
<td class="DevFiles ">
      test.xmb
    </td>
</tr>
<tr>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevRev " width="1%">
      59
    </td>
<td class="DevDate " width="1%">
      Wed 23:15
    </td>
<td class="DevName " width="1%">
      mike
    </td>
<td class="DevComment ">
      Follow the yellow brick road. Follow Follow,  Were off to see the wizard the wonderful wizard of oz, because because of the wonderful things she does.
    </td>
<td class="DevFiles ">
      test.xmb
    </td>
</tr>
<tr>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevStatusBox"><a class="DevStatusBox success"></a></td>
<td class="DevRev " width="1%">
      59
    </td>
<td class="DevDate " width="1%">
      Wed 23:15
    </td>
<td class="DevName " width="1%">
      mike
    </td>
<td class="DevComment ">
      Follow the yellow brick road. Follow Follow,  Were off to see the wizard the wonderful wizard of oz, because because of the wonderful things she does.       Follow the yellow brick road. Follow Follow,  Were off to see the wizard the wonderful wizard of oz, because because of the wonderful things she does.

      Follow the yellow brick road. Follow Follow,  Were off to see the wizard the wonderful wizard of oz, because because of the wonderful things she does.
    </td>
<td class="DevFiles ">
      test.xmb
    </td>
</tr>
</table>
</div>
</body>

<script>

(function() {jQuery.fn['bounds'] = function () {
    var bounds = {
        left: Number.POSITIVE_INFINITY,
        top: Number.POSITIVE_INFINITY,
        right: Number.NEGATIVE_INFINITY,
        bottom: Number.NEGATIVE_INFINITY,
        width: Number.NaN,
        height: Number.NaN
    };

    this.each(function (i,el) {
        var elQ = $(el);
        var off = elQ.offset();
        off.right = off.left + $(elQ).outerWidth();
        off.bottom = off.top + $(elQ).outerHeight();

        if (off.left < bounds.left)
        bounds.left = off.left;

        if (off.top < bounds.top)
        bounds.top = off.top;

        if (off.right > bounds.right)
        bounds.right = off.right;

        if (off.bottom > bounds.bottom)
        bounds.bottom = off.bottom;
    });

    bounds.width = bounds.right - bounds.left;
    bounds.height = bounds.bottom - bounds.top;
    return bounds;
}})();

var paperContainer = $("#paperContainer")
var tableContainer = $("#mainTable")

mainTable = $("#mainTable")
mainTableBounds = mainTable.bounds()
tableWidth = mainTableBounds.width;
tableHeight = mainTableBounds.height;

var tablePaper = Raphael(mainTableBounds.left, mainTableBounds.top, tableWidth, tableHeight);
tablePaper.canvas.style.zIndex = -1;  // using negative number here makes Raphael canvas appear underneath HTML table.  Note: must specify absolute positioning in the Div for the paper for this to work.

$.fn.row = function(i) {
    return $('tr:nth-child('+(i+1)+') td', this);
}
$.fn.column = function(i) {
    return $('tr td:nth-child('+(i+1)+')', this);
}

offset = function( selectionBounds,x,y )
{
    selectionBounds.left += x
    selectionBounds.top += y
    selectionBounds.right += x
    selectionBounds.bottom += y
}

onResize = function()
{
    tablePaper.clear()
    mainTable = $("#mainTable")
    mainTableBounds = mainTable.bounds()
    tableWidth = mainTableBounds.width;
    tableHeight = mainTableBounds.height;
    tableX = mainTableBounds.left;
    tableY = mainTableBounds.top;
    tablePaper.setSize(tableWidth, tableHeight);

    // SW to NE
    {
        startSelection = $("#mainTable tr:nth-child(8) td:nth-child(2)")
        startSelection = startSelection.add( "#mainTable tr:nth-child(8) td:nth-child(3)" )
        startSelectionBounds = startSelection.bounds()
        offset(startSelectionBounds, -tableX, -tableY)
        drawHighlight( startSelectionBounds, tablePaper )

        endSelection = $("#mainTable tr:nth-child(3) td:nth-child(8)")
        endSelection = endSelection.add( "#mainTable tr:nth-child(4) td:nth-child(8)" )
        endSelectionBounds = endSelection.bounds()
        offset(endSelectionBounds, -tableX, -tableY)
        drawHighlight( endSelectionBounds, tablePaper )

        drawSwoop( tablePaper, startSelectionBounds, endSelectionBounds, "orange", "orange" )
    }
    
    // NW to SE
    {
        startSelection = $("#mainTable tr:nth-child(5) td:nth-child(4)")
        startSelectionBounds = startSelection.bounds()
        offset(startSelectionBounds, -tableX, -tableY)
        drawHighlight( startSelectionBounds, tablePaper )

        endSelection = $("#mainTable tr:nth-child(8) td:nth-child(5)")
        endSelectionBounds = endSelection.bounds()
        offset(endSelectionBounds, -tableX, -tableY)
        drawHighlight( endSelectionBounds, tablePaper )

        drawSwoop( tablePaper, startSelectionBounds, endSelectionBounds, "magenta", "magenta" )
    }

    // NE to SW
    {
        startSelection = $("#mainTable tr:nth-child(7) td:nth-child(8)")
        startSelectionBounds = startSelection.bounds()
        offset(startSelectionBounds, -tableX, -tableY)
        drawHighlight( startSelectionBounds, tablePaper )

        endSelection = $("#mainTable tr:nth-child(8) td:nth-child(6)")
        endSelectionBounds = endSelection.bounds()
        offset(endSelectionBounds, -tableX, -tableY)
        drawHighlight( endSelectionBounds, tablePaper )

        drawSwoop( tablePaper, startSelectionBounds, endSelectionBounds, "yellow", "yellow" )
    }

    // SE to NW
    {
        startSelection = $("#mainTable tr:nth-child(6) td:nth-child(8)")
        startSelectionBounds = startSelection.bounds()
        offset(startSelectionBounds, -tableX, -tableY)
        drawHighlight( startSelectionBounds, tablePaper )

        endSelection = $("#mainTable tr:nth-child(5) td:nth-child(5)")
        endSelectionBounds = endSelection.bounds()
        offset(endSelectionBounds, -tableX, -tableY)
        drawHighlight( endSelectionBounds, tablePaper )

        drawSwoop( tablePaper, startSelectionBounds, endSelectionBounds, "blue", "blue" )
    }

}

$(window).resize(onResize);

drawSwoop = function(tablePaper, startSelectionBounds, endSelectionBounds, strokeColor, fillColor)
{

    xDirection = ( startSelectionBounds.right < endSelectionBounds.left ) ? 1 : -1
    yDirection = ( startSelectionBounds.bottom < endSelectionBounds.top ) ? 1 : -1

    t1 = startSelectionBounds.width  // horizontal thickness of the vertical portion 
    t2 = endSelectionBounds.height  // vertical thickness of the horizontal portion
    r1 = t2 // radius of outer curve
    r2 = 15 // radius of inner curve
    
    if ( xDirection == -1 )
    {
        startX = startSelectionBounds.right
        endX = endSelectionBounds.left 
    }
    else
    {
        startX = startSelectionBounds.left
        endX = endSelectionBounds.right 
    }

    if ( yDirection == -1 )
    {
        startY = startSelectionBounds.bottom
        endY = endSelectionBounds.top
    }
    else
    {
        startY = startSelectionBounds.top
        endY = endSelectionBounds.bottom
    }

    path = ""

    // comments are written with a swoop going from SW to NE in mind.

    path += MoveTo( startX, startY ) // lower left
    path += LineTo( startX,endY-(r1*yDirection) ) // head upwards

    // wide arc around top left
    path += ArcTo( 
        r1,r1,0, // radius, tilt
        0,xDirection*yDirection>0?0:1, //flags
        startX+r1*xDirection,endY // end
        ) 

    // head to the right, until endX
    path += LineTo( endX, endY )
    // go down
    path += LineTo( endX, endY-t2*yDirection )

    // back left
    path += LineTo( startX+(t1+r2)*xDirection, endY-t2*yDirection )

    // smaller inside arc
    path += ArcTo(
        r2,r2,0, // radius, tilt
        0,xDirection*yDirection>0?1:0, //flags
        startX+t1*xDirection,endY-((t2+r2)*yDirection) // end
        ) 

    // head down
    path += LineTo( startX+t1*xDirection, startY )

    // back to where we started
    path += LineTo( startX, startY )

    tablePaper.path( path ).attr({stroke: strokeColor, fill: fillColor, opacity: 0.5, "stroke-width" : 2})

    var r3 = t2/3 // radius used to round off square block

}


drawHighlight = function(selectionBounds,paper)
{

    strokeColor = "#FFF"
    fillColor = "#FFF"

    // square block on the right of the text
    path = ""
    path += MoveTo( selectionBounds.left, selectionBounds.top )
    path += LineTo( selectionBounds.right, selectionBounds.top )
    path += LineTo( selectionBounds.right, selectionBounds.bottom )
    path += LineTo( selectionBounds.left, selectionBounds.bottom )
    path += LineTo( selectionBounds.left, selectionBounds.top )
    paper.path( path ).attr({stroke: strokeColor, fill: fillColor, opacity: 0.3, "stroke-width" : 2})

}

Coord = function( x,y )
{
    return x + "," + y + " " 
}

MoveTo = function( x,y )
{
    return CoordCommand( "M", x,y )
}

LineTo = function ( x,y )
{
    return CoordCommand( "L", x,y )
}

// http://www.w3.org/TR/SVG/paths.html#PathDataEllipticalArcCommands
ArcTo = function( rx, ry, xRot, largeArcFlag, sweepFlag, toX, toY )
{
    return " A " + rx + " " + ry + " " + xRot + " " + largeArcFlag + " " + sweepFlag + " " + toX + " " + toY    
}

BezierTo = function( c1x, c1y, c2x, c2y, toX, toY )
{
    return " C " + c1x + " " + c1y + " " + c2x + " " + c2y + " " + toX + " " + toY    
}

CoordCommand = function( command, x,y )
{
    var pathString = command + " " + Coord(x,y)
    return pathString
};

onResize()
//drawSwoop(tablePaper)



</script>


</html>
